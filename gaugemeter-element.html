<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="./tweenlite-import.html">

<dom-module id="gaugemeter-element">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
  </template>
  <script>
    /**
     * `gaugemeter-element`
     * SVG Gauge meter component
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */

    const className = "GaugemeterElement";
    
    var minAngle = 135;
    var maxAngle = 275;
    
    var angle = minAngle;

    var radians = 0;
    var dotX = 0;
    var dotY = 0;

    var baseArc;
    var meterArc;
    var dot;

    class GaugemeterElement extends Polymer.Element {
      static get is() { return 'gaugemeter-element'; }
      static get properties() {
        return {
          radius: {
            type: Number,
            value: 120
          },
          baseArcStrokeWidth: {
            type: Number,
            value: 5
          },
          baseArcStrokeColor: {
            type: String,
            value: '#EEE'
          },
          meterArcStrokeWidth: {
            type: Number,
            value: 5
          },
          meterArcStrokeColor: {
            type: String,
            value: '#C00'
          },
          dotRadius: {
            type: Number,
            value: 10
          },
          dotColor: {
            type: String,
            value: '#C00'
          },
          meterValue: {
            type: Number,
            value: 0,
            reflectToAttribute: true,
            observer: '_onMeterUpdate'
          }
        };
      };

      ready() {
        super.ready();
        angle = minAngle;
        angle %= 360;
        radians = (angle / 180) * Math.PI;

        this.render();
      };

      render() {
        console.log(className + ': render');
        //Caculate the full width of the component
        var _width = (this.radius + this.baseArcStrokeWidth) * 2 + Math.max(0, this.dotRadius - this.baseArcStrokeWidth);

        var radiusDot = this.radius - this.baseArcStrokeWidth;
        dotX = _width / 2 + Math.cos(radians) * radiusDot;
        dotY = _width / 2 + Math.sin(radians) * radiusDot;

        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('version', '1.1');
        svg.setAttribute('width', _width);
        svg.setAttribute('height', _width);
        svg.setAttribute('viewBox', '0 0 ' + _width + ' ' + _width);
        svg.setAttribute('preserveAspectRatio', 'xMidYMid');

        var baseArcSVG = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        baseArcSVG.setAttribute("id", "base");
        baseArcSVG.setAttribute("fill", "none");
        baseArcSVG.setAttribute("stroke", this.baseArcStrokeColor);
        baseArcSVG.setAttribute("stroke-width", this.baseArcStrokeWidth);
        baseArcSVG.setAttribute("cx", _width / 2);
        baseArcSVG.setAttribute("cy", _width / 2);
        var r = this.radius - this.baseArcStrokeWidth;
        baseArcSVG.setAttribute("r", r);
        svg.appendChild(baseArcSVG);

        var meterArcSVG = document.createElementNS("http://www.w3.org/2000/svg", "path");
        meterArcSVG.setAttribute("id", "arc");
        meterArcSVG.setAttribute("d", "M" + _width / 2 + ',' + _width / 2);
        meterArcSVG.setAttribute("stroke", this.meterArcStrokeColor);
        meterArcSVG.setAttribute("stroke-width", this.meterArcStrokeWidth);
        svg.appendChild(meterArcSVG);

        var dotSVG = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        dotSVG.setAttribute("id", "dot");
        dotSVG.setAttribute("fill", this.dotColor);
        dotSVG.setAttribute("cx", _width / 2);
        dotSVG.setAttribute("cy", _width / 2);
        dotSVG.setAttribute('r', this.dotRadius);
        svg.appendChild(dotSVG);

        //Polymer.dom(this.root).appendChild(svg);
        this.shadowRoot.appendChild(svg);

        dot = this.shadowRoot.querySelector('#dot');
        baseArc = this.shadowRoot.querySelector("#arc");

        dot.setAttribute("cx", dotX);
        dot.setAttribute("cy", dotY);
      };

      _onMeterUpdate(newValue, oldValue) {
        //TODO

      }
    }

    window.customElements.define(GaugemeterElement.is, GaugemeterElement);
  </script>
</dom-module>